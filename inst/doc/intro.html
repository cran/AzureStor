<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Hong Ooi" />


<title>Introduction to AzureStor</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Introduction to AzureStor</h1>
<h4 class="author"><em>Hong Ooi</em></h4>



<p>This is a short introduction on how to use AzureStor.</p>
<div id="the-resource-manager-interface-creating-and-deleting-storage-accounts" class="section level2">
<h2>The Resource Manager interface: creating and deleting storage accounts</h2>
<p>AzureStor implements an interface to Azure Resource Manager, which you can use manage storage accounts: creating them, retrieving them, deleting them, and so forth. This is done via the appropriate methods of the <code>az_resource_group</code> class. For example, the following code shows how you might create a new storage account from scratch.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># create a new resource group for the storage account</span></a>
<a class="sourceLine" id="cb1-2" title="2">rg &lt;-<span class="st"> </span>AzureRMR<span class="op">::</span><span class="kw">get_azure_login</span>()<span class="op">$</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="st">    </span><span class="kw">get_subscription</span>(<span class="st">&quot;{subscription_id}&quot;</span>)<span class="op">$</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="st">    </span><span class="kw">create_resource_group</span>(<span class="st">&quot;myresourcegroup&quot;</span>, <span class="dt">location=</span><span class="st">&quot;australiaeast&quot;</span>)</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co"># create the storage account</span></a>
<a class="sourceLine" id="cb1-7" title="7">stor &lt;-<span class="st"> </span>rg<span class="op">$</span><span class="kw">create_storage_account</span>(<span class="st">&quot;mystorage&quot;</span>)</a>
<a class="sourceLine" id="cb1-8" title="8">stor</a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co"># &lt;Azure resource Microsoft.Storage/storageAccounts/mystorage&gt;</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#   Account type: StorageV2</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#   SKU: name=Standard_LRS, tier=Standard </span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co">#   Endpoints:</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">#     dfs: https://mystorage.dfs.core.windows.net/</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co">#     web: https://mystorage.z26.web.core.windows.net/</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">#     blob: https://mystorage.blob.core.windows.net/</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co">#     queue: https://mystorage.queue.core.windows.net/</span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="co">#     table: https://mystorage.table.core.windows.net/</span></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co">#     file: https://mystorage.file.core.windows.net/ </span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="co"># ---</span></a>
<a class="sourceLine" id="cb1-20" title="20"><span class="co">#   id: /subscriptions/35975484-5360-4e67-bf76-14fcb0ab5b9d/resourceGroups/myresourcegroup/providers/Micro ...</span></a>
<a class="sourceLine" id="cb1-21" title="21"><span class="co">#   identity: NULL</span></a>
<a class="sourceLine" id="cb1-22" title="22"><span class="co">#   location: australiaeast</span></a>
<a class="sourceLine" id="cb1-23" title="23"><span class="co">#   managed_by: NULL</span></a>
<a class="sourceLine" id="cb1-24" title="24"><span class="co">#   plan: NULL</span></a>
<a class="sourceLine" id="cb1-25" title="25"><span class="co">#   properties: list(networkAcls, supportsHttpsTrafficOnly, encryption, provisioningState, creationTime,</span></a>
<a class="sourceLine" id="cb1-26" title="26"><span class="co">#     primaryEndpoints, primaryLocation, statusOfPrimary)</span></a>
<a class="sourceLine" id="cb1-27" title="27"><span class="co">#   tags: list()</span></a>
<a class="sourceLine" id="cb1-28" title="28"><span class="co"># ---</span></a>
<a class="sourceLine" id="cb1-29" title="29"><span class="co">#   Methods:</span></a>
<a class="sourceLine" id="cb1-30" title="30"><span class="co">#     check, delete, do_operation, get_account_sas, get_blob_endpoint, get_file_endpoint, get_tags, list_keys,</span></a>
<a class="sourceLine" id="cb1-31" title="31"><span class="co">#     set_api_version, set_tags, sync_fields, update</span></a></code></pre></div>
<p>Without any options, this will create a storage account with the following parameters: - General purpose account (all storage types supported) - Locally redundant storage (LRS) replication - Hot access tier (for blob storage) - HTTPS connection required for access</p>
<p>You can change these by setting the arguments to <code>create_storage_account()</code>. For example, to create an account with geo-redundant storage replication and the default blob access tier set to “cool”:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">stor2 &lt;-<span class="st"> </span>rg<span class="op">$</span><span class="kw">create_storage_account</span>(<span class="st">&quot;myotherstorage&quot;</span>,</a>
<a class="sourceLine" id="cb2-2" title="2">    <span class="dt">replication=</span><span class="st">&quot;Standard_GRS&quot;</span>,</a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="dt">access_tier=</span><span class="st">&quot;cool&quot;</span>)</a></code></pre></div>
<p>And to create a blob storage account and allow non-encrypted (HTTP) connections:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">blobstor &lt;-<span class="st"> </span>rg<span class="op">$</span><span class="kw">create_storage_account</span>(<span class="st">&quot;myblobstorage&quot;</span>,</a>
<a class="sourceLine" id="cb3-2" title="2">    <span class="dt">kind=</span><span class="st">&quot;blobStorage&quot;</span>,</a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="dt">https_only=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<p>You can verify that these accounts have been created by going to the Azure Portal (<a href="https://portal.azure.com/" class="uri">https://portal.azure.com/</a>).</p>
<p>One factor to remember is that all storage accounts in Azure share a common namespace. For example, there can only be one storage account named “mystorage” at a time, across all Azure users.</p>
<p>To retrieve an existing storage account, use the <code>get_storage_account()</code> method. Only the storage account name is required.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># retrieve one of the accounts created above</span></a>
<a class="sourceLine" id="cb4-2" title="2">stor2 &lt;-<span class="st"> </span>rg<span class="op">$</span><span class="kw">get_storage_account</span>(<span class="st">&quot;myotherstorage&quot;</span>)</a></code></pre></div>
<p>Finally, to delete a storage account, you simply call its <code>delete()</code> method. Alternatively, you can call the <code>delete_storage_account()</code> method of the <code>az_resource_group</code> class, which will do the same thing. In both cases, AzureStor will prompt you for confirmation that you really want to delete the storage account.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># delete the storage accounts created above</span></a>
<a class="sourceLine" id="cb5-2" title="2">stor<span class="op">$</span><span class="kw">delete</span>()</a>
<a class="sourceLine" id="cb5-3" title="3">stor2<span class="op">$</span><span class="kw">delete</span>()</a>
<a class="sourceLine" id="cb5-4" title="4">blobstor<span class="op">$</span><span class="kw">delete</span>()</a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co"># if you don&#39;t have a storage account object, use the resource group method:</span></a>
<a class="sourceLine" id="cb5-7" title="7">rg<span class="op">$</span><span class="kw">delete_storage_account</span>(<span class="st">&quot;mystorage&quot;</span>)</a>
<a class="sourceLine" id="cb5-8" title="8">rg<span class="op">$</span><span class="kw">delete_storage_account</span>(<span class="st">&quot;myotherstorage&quot;</span>)</a>
<a class="sourceLine" id="cb5-9" title="9">rg<span class="op">$</span><span class="kw">delete_storage_account</span>(<span class="st">&quot;myblobstorage&quot;</span>)</a></code></pre></div>
</div>
<div id="the-client-interface-working-with-storage" class="section level2">
<h2>The client interface: working with storage</h2>
<div id="storage-endpoints" class="section level3">
<h3>Storage endpoints</h3>
<p>Perhaps the more relevant part of AzureStor for most users is its client interface to storage. With this, you can upload and download files and blobs, create containers and shares, list files, and so on. Unlike the ARM interface, the client interface uses S3 classes. This is for a couple of reasons: it is more familiar to most R users, and it is consistent with most other data manipulation packages in R, in particular the <a href="https://tidyverse.org/">tidyverse</a>.</p>
<p>The starting point for client access is the <code>storage_endpoint</code> object, which stores information about the endpoint of a storage account: the URL that you use to access storage, along with any authentication information needed. The easiest way to obtain an endpoint object is via the storage account resource object’s <code>get_blob_endpoint()</code>, <code>get_file_endpoint()</code> and <code>get_adls_endpoint()</code> methods:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># create the storage account</span></a>
<a class="sourceLine" id="cb6-2" title="2">rg &lt;-<span class="st"> </span>AzureRMR<span class="op">::</span>az_rm<span class="op">$</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">    </span><span class="kw">new</span>(<span class="dt">tenant=</span><span class="st">&quot;{tenant_id}&quot;</span>, <span class="dt">app=</span><span class="st">&quot;{app_id}&quot;</span>, <span class="dt">password=</span><span class="st">&quot;{password}&quot;</span>)<span class="op">$</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="st">    </span><span class="kw">get_subscription</span>(<span class="st">&quot;{subscription_id}&quot;</span>)<span class="op">$</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="st">    </span><span class="kw">get_resource_group</span>(<span class="st">&quot;myresourcegroup&quot;</span>)</a>
<a class="sourceLine" id="cb6-6" title="6">stor &lt;-<span class="st"> </span>rg<span class="op">$</span><span class="kw">create_storage_account</span>(<span class="st">&quot;mystorage&quot;</span>)</a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8">stor<span class="op">$</span><span class="kw">get_blob_endpoint</span>()</a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co"># Azure blob storage endpoint</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co"># URL: https://mystorage.blob.core.windows.net/</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co"># Access key: &lt;hidden&gt;</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co"># Account shared access signature: &lt;none supplied&gt;</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co"># Storage API version: 2018-03-28</span></a>
<a class="sourceLine" id="cb6-14" title="14"></a>
<a class="sourceLine" id="cb6-15" title="15">stor<span class="op">$</span><span class="kw">get_file_endpoint</span>()</a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co"># Azure file storage endpoint</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="co"># URL: https://mystorage.file.core.windows.net/</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co"># Access key: &lt;hidden&gt;</span></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="co"># Account shared access signature: &lt;none supplied&gt;</span></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="co"># Storage API version: 2018-03-28</span></a>
<a class="sourceLine" id="cb6-21" title="21"></a>
<a class="sourceLine" id="cb6-22" title="22">stor<span class="op">$</span><span class="kw">get_adls_endpoint</span>()</a>
<a class="sourceLine" id="cb6-23" title="23"><span class="co"># Azure Data Lake Storage Gen2 endpoint</span></a>
<a class="sourceLine" id="cb6-24" title="24"><span class="co"># URL: https://mystorage.dfs.core.windows.net/</span></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="co"># Access key: &lt;hidden&gt;</span></a>
<a class="sourceLine" id="cb6-26" title="26"><span class="co"># Account shared access signature: &lt;none supplied&gt;</span></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="co"># Storage API version: 2018-03-28</span></a></code></pre></div>
<p>More practically, you will usually have to work with a storage endpoint without having access to the resource itself. In this case, you can create the endpoint object directly with the <code>storage_endpoint</code> function. When you create the endpoint this way, you have to provide the access key explicitly (assuming you know what it is).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># same as using the get_xxxx_endpoint() methods above</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co"># AzureStor will infer the type of storage from the URL</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">storage_endpoint</span>(<span class="st">&quot;https://mystorage.blob.core.windows.net/&quot;</span>,</a>
<a class="sourceLine" id="cb7-4" title="4">    <span class="dt">key=</span><span class="st">&quot;mystorageaccesskey&quot;</span>)</a>
<a class="sourceLine" id="cb7-5" title="5"><span class="kw">storage_endpoint</span>(<span class="st">&quot;https://mystorage.file.core.windows.net/&quot;</span>,</a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="dt">key=</span><span class="st">&quot;mystorageaccesskey&quot;</span>)</a>
<a class="sourceLine" id="cb7-7" title="7"><span class="kw">storage_endpoint</span>(<span class="st">&quot;https://mystorage.dfs.core.windows.net/&quot;</span>,</a>
<a class="sourceLine" id="cb7-8" title="8">    <span class="dt">key=</span><span class="st">&quot;mystorageaccesskey&quot;</span>)</a></code></pre></div>
<p>Instead of an access key, you can provide either an authentication token or a <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-dotnet-shared-access-signature-part-1">shared access signature (SAS)</a> to gain authenticated access. The main difference between using a key and these methods is that a key unlocks access to the <em>entire</em> storage account. A user who has a key can access all containers and files, and can transfer, modify and delete data without restriction. On the other hand, a user with a token or a SAS can be limited to have access only to specific containers, or be limited to read access, or only for a given span of time, and so on. This is usually much better in terms of security.</p>
<p>Usually, these authentication objects will be provided to you by your system administrator. However, if you have the storage account resource object, you can generate and use a SAS as follows. Note that generating a SAS requires the storage account’s access key.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># shared access signature: read/write access, container+object access, valid for 8 hours</span></a>
<a class="sourceLine" id="cb8-2" title="2">sas &lt;-<span class="st"> </span>stor<span class="op">$</span><span class="kw">get_account_sas</span>(<span class="dt">permissions=</span><span class="st">&quot;rw&quot;</span>,</a>
<a class="sourceLine" id="cb8-3" title="3">    <span class="dt">resource_types=</span><span class="st">&quot;co&quot;</span>,</a>
<a class="sourceLine" id="cb8-4" title="4">    <span class="dt">start=</span><span class="kw">Sys.time</span>(),</a>
<a class="sourceLine" id="cb8-5" title="5">    <span class="dt">end=</span><span class="kw">Sys.time</span>() <span class="op">+</span><span class="st"> </span><span class="dv">8</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span>,</a>
<a class="sourceLine" id="cb8-6" title="6">    <span class="dt">key=</span>stor<span class="op">$</span><span class="kw">list_keys</span>()[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb8-7" title="7"></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co"># create an endpoint object with a SAS, but without an access key</span></a>
<a class="sourceLine" id="cb8-9" title="9">blob_endp &lt;-<span class="st"> </span><span class="kw">storage_endpoint</span>(<span class="st">&quot;https://mystorage.blob.core.windows.net/&quot;</span>, <span class="dt">sas=</span>sas)</a></code></pre></div>
</div>
<div id="storage-container-access" class="section level3">
<h3>Storage container access</h3>
<p>The client interface for AzureStor supports blob storage, file storage, and Azure Data Lake Storage Gen 2. All of these storage types have a similar structure. In particular, the storage within each type is organised into containers: blob <em>containers</em>, file <em>shares</em>, and ADLSgen2 <em>filesystems</em>.</p>
<p>Given an endpoint object, AzureStor provides the following generics for working with containers. They will dispatch to the appropriate underlying methods for each storage type.</p>
<ul>
<li><code>storage_container</code>: get an existing container object: a blob container, file share or ADLS filesystem</li>
<li><code>list_storage_containers</code>: return a list of container objects</li>
<li><code>create_storage_container</code>: create a new container object</li>
<li><code>delete_storage_container</code>: delete a container object</li>
</ul>
<p>Here is some example blob container code showing their use. The file share and ADLSgen2 filesystem code is very similar.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># an existing container</span></a>
<a class="sourceLine" id="cb9-2" title="2">cont &lt;-<span class="st"> </span><span class="kw">storage_container</span>(blob_endp, <span class="st">&quot;mycontainer&quot;</span>)</a>
<a class="sourceLine" id="cb9-3" title="3">cont</a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co"># Azure blob container &#39;mycontainer&#39;</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co"># URL: https://mystorage.blob.core.windows.net/mycontainer</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co"># Access key: &lt;hidden&gt;</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co"># Account shared access signature: &lt;none supplied&gt;</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co"># Storage API version: 2018-03-28</span></a>
<a class="sourceLine" id="cb9-9" title="9"></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co"># create a new container</span></a>
<a class="sourceLine" id="cb9-11" title="11">newcont &lt;-<span class="st"> </span><span class="kw">create_storage_container</span>(blob_endp, <span class="st">&quot;mynewcontainer&quot;</span>, <span class="dt">public_access=</span><span class="st">&quot;blob&quot;</span>)</a>
<a class="sourceLine" id="cb9-12" title="12">newcont</a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co"># Azure blob container &#39;mynewcontainer&#39;</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="co"># URL: https://mystorage.blob.core.windows.net/mynewcontainer</span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="co"># Access key: &lt;hidden&gt;</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co"># Account shared access signature: &lt;none supplied&gt;</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co"># Storage API version: 2018-03-28</span></a>
<a class="sourceLine" id="cb9-18" title="18"></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co"># delete the container</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="kw">delete_storage_container</span>(newcont)</a>
<a class="sourceLine" id="cb9-21" title="21"></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="co"># piping also works</span></a>
<a class="sourceLine" id="cb9-23" title="23"><span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb9-24" title="24">blob_endp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="st">    </span><span class="kw">storage_container</span>(<span class="st">&quot;mycontainer&quot;</span>)</a>
<a class="sourceLine" id="cb9-26" title="26"><span class="co"># Azure blob container &#39;mycontainer&#39;</span></a>
<a class="sourceLine" id="cb9-27" title="27"><span class="co"># URL: https://mystorage.blob.core.windows.net/mycontainer</span></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="co"># Access key: &lt;hidden&gt;</span></a>
<a class="sourceLine" id="cb9-29" title="29"><span class="co"># Account shared access signature: &lt;none supplied&gt;</span></a>
<a class="sourceLine" id="cb9-30" title="30"><span class="co"># Storage API version: 2018-03-28</span></a></code></pre></div>
<p>As a convenience, instead of providing an endpoint object and a container name, you can also provide the full URL to the container. If you do this, you’ll also have to supply any necessary authentication details such as the access key or SAS.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">storage_container</span>(<span class="st">&quot;https://mystorage.blob.core.windows.net/mycontainer&quot;</span>,</a>
<a class="sourceLine" id="cb10-2" title="2">    <span class="dt">key=</span><span class="st">&quot;mystorageaccountkey&quot;</span>)</a></code></pre></div>
</div>
<div id="file-transfers" class="section level3">
<h3>File transfers</h3>
<p>To transfer files and blobs to and from a storage container, use the following generics. As before, the appropriate method will be called for the type of storage.</p>
<ul>
<li><code>storage_upload</code>: upload a file to a storage container</li>
<li><code>storage_download</code>: download a file</li>
<li><code>storage_multiupload</code> upload multiple files in parallel</li>
<li><code>storage_multidownload</code>: download multiple files in parallel</li>
</ul>
<p>The <code>storage_multiupload</code> and <code>storage_multidownload</code> methods use a pool of background R processes to do the transfers in parallel, which usually results in major speedups when transferring multiple small files. The pool is created the first time a parallel file transfer is performed, and persists for the duration of the R session; this means you don’t have to wait for the pool to be (re-)created each time.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># upload a file to a blob container</span></a>
<a class="sourceLine" id="cb11-2" title="2">blob_endp &lt;-<span class="st"> </span><span class="kw">storage_endpoint</span>(<span class="st">&quot;https://mystorage.blob.core.windows.net/&quot;</span>,</a>
<a class="sourceLine" id="cb11-3" title="3">    <span class="dt">key=</span><span class="st">&quot;mystorageaccesskey&quot;</span>)</a>
<a class="sourceLine" id="cb11-4" title="4">cont &lt;-<span class="st"> </span><span class="kw">storage_container</span>(blob_endp, <span class="st">&quot;mycontainer&quot;</span>)</a>
<a class="sourceLine" id="cb11-5" title="5">storage_uploadcont, src=<span class="st">&quot;myfile&quot;</span>, dest=<span class="st">&quot;myblob&quot;</span><span class="er">)</span></a>
<a class="sourceLine" id="cb11-6" title="6"></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co"># again, piping works</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="kw">blob_endpoint</span>(<span class="st">&quot;https://mystorage.blob.core.windows.net/&quot;</span>, <span class="dt">key=</span><span class="st">&quot;mystorageaccesskey&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="st">    </span><span class="kw">storage_container</span>(<span class="st">&quot;mycontainer&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="st">    </span><span class="kw">storage_upload</span>(<span class="st">&quot;myfile&quot;</span>, <span class="st">&quot;myblob&quot;</span>)</a>
<a class="sourceLine" id="cb11-11" title="11"></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="co"># download a blob, overwriting any existing destination file</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="kw">storage_download</span>(cont, <span class="st">&quot;myblob&quot;</span>, <span class="st">&quot;myfile&quot;</span>, <span class="dt">overwrite=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-14" title="14"></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="co"># download multiple files to a directory</span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="kw">storage_multidownload</span>(cont, <span class="st">&quot;*.zip&quot;</span>, <span class="st">&quot;~/zipfiles&quot;</span>)</a></code></pre></div>
<p>AzureStor also provides the following generics as convenience functions:</p>
<ul>
<li><code>upload_to_url</code>: upload a file to a destination given by a URL</li>
<li><code>download_from_url</code>: download a file from a source given by a URL, the opposite of <code>upload_from_url</code>. This is analogous to base R’s <code>download.file</code> but with support for authentication.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">download_from_url</span>(<span class="st">&quot;https://mystorage.blob.core.windows.net/mycontainer/myblob&quot;</span>,</a>
<a class="sourceLine" id="cb12-2" title="2">    <span class="st">&quot;myfile&quot;</span>,</a>
<a class="sourceLine" id="cb12-3" title="3">    <span class="dt">key=</span><span class="st">&quot;mystorageaccesskey&quot;</span>,</a>
<a class="sourceLine" id="cb12-4" title="4">    <span class="dt">overwrite=</span><span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="managing-storage-objects" class="section level3">
<h3>Managing storage objects</h3>
<p>AzureStor provides the following generics for managing files and blobs within a storage container.</p>
<ul>
<li><code>list_storage_files</code>: list files and blobs within a directory (or, for blob storage, within the container)</li>
<li><code>create_storage_dir</code>: create a directory</li>
<li><code>delete_storage_dir</code>: delete a directory</li>
<li><code>delete_storage_file</code>: delete a file or blob</li>
</ul>
<p>As blob storage doesn’t support directories, <code>create_storage_dir</code> and <code>delete_storage_dir</code> will throw an error if called on a blob container.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># list blobs inside a blob container</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">list_storage_files</span>(cont)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">#      Name       Last-Modified Content-Length</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co"># 1  fs.txt 2018-10-13 11:34:30            132</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co"># 2 fs2.txt 2018-10-13 11:04:36         731930</span></a>
<a class="sourceLine" id="cb13-6" title="6"></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co"># if you want only the filenames</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="kw">list_storage_files</span>(cont, <span class="dt">info=</span><span class="st">&quot;name&quot;</span>)</a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co"># [1] &quot;fs.txt&quot;  &quot;fs2.txt&quot;</span></a>
<a class="sourceLine" id="cb13-10" title="10"></a>
<a class="sourceLine" id="cb13-11" title="11"></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co"># files inside a file share</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="kw">list_storage_files</span>(share, <span class="st">&quot;/&quot;</span>)</a>
<a class="sourceLine" id="cb13-14" title="14"><span class="co">#       name type   size</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="co"># 1 100k.txt File 100000</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="co"># 2   fs.txt File    132</span></a>
<a class="sourceLine" id="cb13-17" title="17"></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="co"># create a directory under the root of the file share</span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="kw">create_storage_dir</span>(share, <span class="st">&quot;newdir&quot;</span>)</a>
<a class="sourceLine" id="cb13-20" title="20"></a>
<a class="sourceLine" id="cb13-21" title="21"><span class="co"># confirm that the directory has been created</span></a>
<a class="sourceLine" id="cb13-22" title="22"><span class="kw">list_storage_files</span>(share, <span class="st">&quot;/&quot;</span>)</a>
<a class="sourceLine" id="cb13-23" title="23"><span class="co">#       name      type   size</span></a>
<a class="sourceLine" id="cb13-24" title="24"><span class="co"># 1 100k.txt      File 100000</span></a>
<a class="sourceLine" id="cb13-25" title="25"><span class="co"># 2   fs.txt      File    132</span></a>
<a class="sourceLine" id="cb13-26" title="26"><span class="co"># 3   newdir Directory     NA</span></a>
<a class="sourceLine" id="cb13-27" title="27"></a>
<a class="sourceLine" id="cb13-28" title="28"><span class="co"># delete the directory</span></a>
<a class="sourceLine" id="cb13-29" title="29"><span class="kw">delete_storage_dir</span>(share, <span class="st">&quot;newdir&quot;</span>)</a></code></pre></div>
<p>For more information about the different types of storage, see the <a href="https://docs.microsoft.com/en-us/azure/storage/">Microsoft Docs site</a>. Note that there are other types of storage (queue, table) that do not have a client interface exposed by AzureStor.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
